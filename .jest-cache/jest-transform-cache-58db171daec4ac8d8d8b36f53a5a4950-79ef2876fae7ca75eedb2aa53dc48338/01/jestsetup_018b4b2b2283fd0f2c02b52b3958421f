45db00bf256a5713a41dedf12ca8d93a
"use strict";

/**
 * Jest 測試環境設置檔案
 * 基於 Jest 最佳實踐，為 CI 環境提供必要的全域模擬
 * 建立時間: 2025-08-26T23:10:06+08:00 [time.now:Asia/Taipei]
 * 負責人: haotool
 */

// 修復 CI 環境中 IndexedDB 不可用的問題
if (typeof indexedDB === 'undefined' || typeof window === 'undefined') {
  // 在 Node.js 環境中模擬 IndexedDB
  require('fake-indexeddb/auto');

  // 確保全域變數可用
  global.indexedDB = global.indexedDB || require('fake-indexeddb');
  global.IDBKeyRange = global.IDBKeyRange || require('fake-indexeddb/lib/FDBKeyRange');
  global.IDBTransaction = global.IDBTransaction || require('fake-indexeddb/lib/FDBTransaction');
  global.IDBDatabase = global.IDBDatabase || require('fake-indexeddb/lib/FDBDatabase');
  global.IDBObjectStore = global.IDBObjectStore || require('fake-indexeddb/lib/FDBObjectStore');
  global.IDBIndex = global.IDBIndex || require('fake-indexeddb/lib/FDBIndex');
  global.IDBCursor = global.IDBCursor || require('fake-indexeddb/lib/FDBCursor');
  global.IDBRequest = global.IDBRequest || require('fake-indexeddb/lib/FDBRequest');
}

// 設置 Jest 測試環境的其他全域變數
if (typeof window !== 'undefined') {
  // 模擬 requestAnimationFrame 和 cancelAnimationFrame
  global.requestAnimationFrame = global.requestAnimationFrame || (cb => setTimeout(cb, 16));
  global.cancelAnimationFrame = global.cancelAnimationFrame || clearTimeout;

  // 模擬 ResizeObserver
  global.ResizeObserver = global.ResizeObserver || class ResizeObserver {
    constructor(callback) {
      this.callback = callback;
    }
    observe() {
      // 模擬實作
    }
    unobserve() {
      // 模擬實作
    }
    disconnect() {
      // 模擬實作
    }
  };

  // 模擬 IntersectionObserver
  global.IntersectionObserver = global.IntersectionObserver || class IntersectionObserver {
    constructor(callback, options) {
      this.callback = callback;
      this.options = options;
    }
    observe() {
      // 模擬實作
    }
    unobserve() {
      // 模擬實作
    }
    disconnect() {
      // 模擬實作
    }
  };
}

// 設置測試超時時間（5 秒）
jest.setTimeout(5000);

// 設置全域錯誤處理
process.on('unhandledRejection', (reason, promise) => {
  console.error('Unhandled Rejection at:', promise, 'reason:', reason);
});
console.log('✅ Jest 測試環境設置完成');
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJpbmRleGVkREIiLCJ3aW5kb3ciLCJyZXF1aXJlIiwiZ2xvYmFsIiwiSURCS2V5UmFuZ2UiLCJJREJUcmFuc2FjdGlvbiIsIklEQkRhdGFiYXNlIiwiSURCT2JqZWN0U3RvcmUiLCJJREJJbmRleCIsIklEQkN1cnNvciIsIklEQlJlcXVlc3QiLCJyZXF1ZXN0QW5pbWF0aW9uRnJhbWUiLCJjYiIsInNldFRpbWVvdXQiLCJjYW5jZWxBbmltYXRpb25GcmFtZSIsImNsZWFyVGltZW91dCIsIlJlc2l6ZU9ic2VydmVyIiwiY29uc3RydWN0b3IiLCJjYWxsYmFjayIsIm9ic2VydmUiLCJ1bm9ic2VydmUiLCJkaXNjb25uZWN0IiwiSW50ZXJzZWN0aW9uT2JzZXJ2ZXIiLCJvcHRpb25zIiwiamVzdCIsInByb2Nlc3MiLCJvbiIsInJlYXNvbiIsInByb21pc2UiLCJjb25zb2xlIiwiZXJyb3IiLCJsb2ciXSwic291cmNlcyI6WyJqZXN0LnNldHVwLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogSmVzdCDmuKzoqabnkrDlooPoqK3nva7mqpTmoYhcbiAqIOWfuuaWvCBKZXN0IOacgOS9s+Wvpui4kO+8jOeCuiBDSSDnkrDlooPmj5Dkvpvlv4XopoHnmoTlhajln5/mqKHmk6xcbiAqIOW7uueri+aZgumWkzogMjAyNS0wOC0yNlQyMzoxMDowNiswODowMCBbdGltZS5ub3c6QXNpYS9UYWlwZWldXG4gKiDosqDosqzkuro6IGhhb3Rvb2xcbiAqL1xuXG4vLyDkv67lvqkgQ0kg55Kw5aKD5LitIEluZGV4ZWREQiDkuI3lj6/nlKjnmoTllY/poYxcbmlmICh0eXBlb2YgaW5kZXhlZERCID09PSAndW5kZWZpbmVkJyB8fCB0eXBlb2Ygd2luZG93ID09PSAndW5kZWZpbmVkJykge1xuICAvLyDlnKggTm9kZS5qcyDnkrDlooPkuK3mqKHmk6wgSW5kZXhlZERCXG4gIHJlcXVpcmUoJ2Zha2UtaW5kZXhlZGRiL2F1dG8nKTtcbiAgXG4gIC8vIOeiuuS/neWFqOWfn+iuiuaVuOWPr+eUqFxuICBnbG9iYWwuaW5kZXhlZERCID0gZ2xvYmFsLmluZGV4ZWREQiB8fCByZXF1aXJlKCdmYWtlLWluZGV4ZWRkYicpO1xuICBnbG9iYWwuSURCS2V5UmFuZ2UgPSBnbG9iYWwuSURCS2V5UmFuZ2UgfHwgcmVxdWlyZSgnZmFrZS1pbmRleGVkZGIvbGliL0ZEQktleVJhbmdlJyk7XG4gIGdsb2JhbC5JREJUcmFuc2FjdGlvbiA9IGdsb2JhbC5JREJUcmFuc2FjdGlvbiB8fCByZXF1aXJlKCdmYWtlLWluZGV4ZWRkYi9saWIvRkRCVHJhbnNhY3Rpb24nKTtcbiAgZ2xvYmFsLklEQkRhdGFiYXNlID0gZ2xvYmFsLklEQkRhdGFiYXNlIHx8IHJlcXVpcmUoJ2Zha2UtaW5kZXhlZGRiL2xpYi9GREJEYXRhYmFzZScpO1xuICBnbG9iYWwuSURCT2JqZWN0U3RvcmUgPSBnbG9iYWwuSURCT2JqZWN0U3RvcmUgfHwgcmVxdWlyZSgnZmFrZS1pbmRleGVkZGIvbGliL0ZEQk9iamVjdFN0b3JlJyk7XG4gIGdsb2JhbC5JREJJbmRleCA9IGdsb2JhbC5JREJJbmRleCB8fCByZXF1aXJlKCdmYWtlLWluZGV4ZWRkYi9saWIvRkRCSW5kZXgnKTtcbiAgZ2xvYmFsLklEQkN1cnNvciA9IGdsb2JhbC5JREJDdXJzb3IgfHwgcmVxdWlyZSgnZmFrZS1pbmRleGVkZGIvbGliL0ZEQkN1cnNvcicpO1xuICBnbG9iYWwuSURCUmVxdWVzdCA9IGdsb2JhbC5JREJSZXF1ZXN0IHx8IHJlcXVpcmUoJ2Zha2UtaW5kZXhlZGRiL2xpYi9GREJSZXF1ZXN0Jyk7XG59XG5cbi8vIOioree9riBKZXN0IOa4rOippueSsOWig+eahOWFtuS7luWFqOWfn+iuiuaVuFxuaWYgKHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnKSB7XG4gIC8vIOaooeaTrCByZXF1ZXN0QW5pbWF0aW9uRnJhbWUg5ZKMIGNhbmNlbEFuaW1hdGlvbkZyYW1lXG4gIGdsb2JhbC5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUgPSBnbG9iYWwucmVxdWVzdEFuaW1hdGlvbkZyYW1lIHx8ICgoY2IpID0+IHNldFRpbWVvdXQoY2IsIDE2KSk7XG4gIGdsb2JhbC5jYW5jZWxBbmltYXRpb25GcmFtZSA9IGdsb2JhbC5jYW5jZWxBbmltYXRpb25GcmFtZSB8fCBjbGVhclRpbWVvdXQ7XG4gIFxuICAvLyDmqKHmk6wgUmVzaXplT2JzZXJ2ZXJcbiAgZ2xvYmFsLlJlc2l6ZU9ic2VydmVyID0gZ2xvYmFsLlJlc2l6ZU9ic2VydmVyIHx8IGNsYXNzIFJlc2l6ZU9ic2VydmVyIHtcbiAgICBjb25zdHJ1Y3RvcihjYWxsYmFjaykge1xuICAgICAgdGhpcy5jYWxsYmFjayA9IGNhbGxiYWNrO1xuICAgIH1cbiAgICBvYnNlcnZlKCkge1xuICAgICAgLy8g5qih5pOs5a+m5L2cXG4gICAgfVxuICAgIHVub2JzZXJ2ZSgpIHtcbiAgICAgIC8vIOaooeaTrOWvpuS9nFxuICAgIH1cbiAgICBkaXNjb25uZWN0KCkge1xuICAgICAgLy8g5qih5pOs5a+m5L2cXG4gICAgfVxuICB9O1xuICBcbiAgLy8g5qih5pOsIEludGVyc2VjdGlvbk9ic2VydmVyXG4gIGdsb2JhbC5JbnRlcnNlY3Rpb25PYnNlcnZlciA9IGdsb2JhbC5JbnRlcnNlY3Rpb25PYnNlcnZlciB8fCBjbGFzcyBJbnRlcnNlY3Rpb25PYnNlcnZlciB7XG4gICAgY29uc3RydWN0b3IoY2FsbGJhY2ssIG9wdGlvbnMpIHtcbiAgICAgIHRoaXMuY2FsbGJhY2sgPSBjYWxsYmFjaztcbiAgICAgIHRoaXMub3B0aW9ucyA9IG9wdGlvbnM7XG4gICAgfVxuICAgIG9ic2VydmUoKSB7XG4gICAgICAvLyDmqKHmk6zlr6bkvZxcbiAgICB9XG4gICAgdW5vYnNlcnZlKCkge1xuICAgICAgLy8g5qih5pOs5a+m5L2cXG4gICAgfVxuICAgIGRpc2Nvbm5lY3QoKSB7XG4gICAgICAvLyDmqKHmk6zlr6bkvZxcbiAgICB9XG4gIH07XG59XG5cbi8vIOioree9rua4rOippui2heaZguaZgumWk++8iDUg56eS77yJXG5qZXN0LnNldFRpbWVvdXQoNTAwMCk7XG5cbi8vIOioree9ruWFqOWfn+mMr+iqpOiZleeQhlxucHJvY2Vzcy5vbigndW5oYW5kbGVkUmVqZWN0aW9uJywgKHJlYXNvbiwgcHJvbWlzZSkgPT4ge1xuICBjb25zb2xlLmVycm9yKCdVbmhhbmRsZWQgUmVqZWN0aW9uIGF0OicsIHByb21pc2UsICdyZWFzb246JywgcmVhc29uKTtcbn0pO1xuXG5jb25zb2xlLmxvZygn4pyFIEplc3Qg5ris6Kmm55Kw5aKD6Kit572u5a6M5oiQJyk7XG4iXSwibWFwcGluZ3MiOiI7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsSUFBSSxPQUFPQSxTQUFTLEtBQUssV0FBVyxJQUFJLE9BQU9DLE1BQU0sS0FBSyxXQUFXLEVBQUU7RUFDckU7RUFDQUMsT0FBTyxDQUFDLHFCQUFxQixDQUFDOztFQUU5QjtFQUNBQyxNQUFNLENBQUNILFNBQVMsR0FBR0csTUFBTSxDQUFDSCxTQUFTLElBQUlFLE9BQU8sQ0FBQyxnQkFBZ0IsQ0FBQztFQUNoRUMsTUFBTSxDQUFDQyxXQUFXLEdBQUdELE1BQU0sQ0FBQ0MsV0FBVyxJQUFJRixPQUFPLENBQUMsZ0NBQWdDLENBQUM7RUFDcEZDLE1BQU0sQ0FBQ0UsY0FBYyxHQUFHRixNQUFNLENBQUNFLGNBQWMsSUFBSUgsT0FBTyxDQUFDLG1DQUFtQyxDQUFDO0VBQzdGQyxNQUFNLENBQUNHLFdBQVcsR0FBR0gsTUFBTSxDQUFDRyxXQUFXLElBQUlKLE9BQU8sQ0FBQyxnQ0FBZ0MsQ0FBQztFQUNwRkMsTUFBTSxDQUFDSSxjQUFjLEdBQUdKLE1BQU0sQ0FBQ0ksY0FBYyxJQUFJTCxPQUFPLENBQUMsbUNBQW1DLENBQUM7RUFDN0ZDLE1BQU0sQ0FBQ0ssUUFBUSxHQUFHTCxNQUFNLENBQUNLLFFBQVEsSUFBSU4sT0FBTyxDQUFDLDZCQUE2QixDQUFDO0VBQzNFQyxNQUFNLENBQUNNLFNBQVMsR0FBR04sTUFBTSxDQUFDTSxTQUFTLElBQUlQLE9BQU8sQ0FBQyw4QkFBOEIsQ0FBQztFQUM5RUMsTUFBTSxDQUFDTyxVQUFVLEdBQUdQLE1BQU0sQ0FBQ08sVUFBVSxJQUFJUixPQUFPLENBQUMsK0JBQStCLENBQUM7QUFDbkY7O0FBRUE7QUFDQSxJQUFJLE9BQU9ELE1BQU0sS0FBSyxXQUFXLEVBQUU7RUFDakM7RUFDQUUsTUFBTSxDQUFDUSxxQkFBcUIsR0FBR1IsTUFBTSxDQUFDUSxxQkFBcUIsS0FBTUMsRUFBRSxJQUFLQyxVQUFVLENBQUNELEVBQUUsRUFBRSxFQUFFLENBQUMsQ0FBQztFQUMzRlQsTUFBTSxDQUFDVyxvQkFBb0IsR0FBR1gsTUFBTSxDQUFDVyxvQkFBb0IsSUFBSUMsWUFBWTs7RUFFekU7RUFDQVosTUFBTSxDQUFDYSxjQUFjLEdBQUdiLE1BQU0sQ0FBQ2EsY0FBYyxJQUFJLE1BQU1BLGNBQWMsQ0FBQztJQUNwRUMsV0FBV0EsQ0FBQ0MsUUFBUSxFQUFFO01BQ3BCLElBQUksQ0FBQ0EsUUFBUSxHQUFHQSxRQUFRO0lBQzFCO0lBQ0FDLE9BQU9BLENBQUEsRUFBRztNQUNSO0lBQUE7SUFFRkMsU0FBU0EsQ0FBQSxFQUFHO01BQ1Y7SUFBQTtJQUVGQyxVQUFVQSxDQUFBLEVBQUc7TUFDWDtJQUFBO0VBRUosQ0FBQzs7RUFFRDtFQUNBbEIsTUFBTSxDQUFDbUIsb0JBQW9CLEdBQUduQixNQUFNLENBQUNtQixvQkFBb0IsSUFBSSxNQUFNQSxvQkFBb0IsQ0FBQztJQUN0RkwsV0FBV0EsQ0FBQ0MsUUFBUSxFQUFFSyxPQUFPLEVBQUU7TUFDN0IsSUFBSSxDQUFDTCxRQUFRLEdBQUdBLFFBQVE7TUFDeEIsSUFBSSxDQUFDSyxPQUFPLEdBQUdBLE9BQU87SUFDeEI7SUFDQUosT0FBT0EsQ0FBQSxFQUFHO01BQ1I7SUFBQTtJQUVGQyxTQUFTQSxDQUFBLEVBQUc7TUFDVjtJQUFBO0lBRUZDLFVBQVVBLENBQUEsRUFBRztNQUNYO0lBQUE7RUFFSixDQUFDO0FBQ0g7O0FBRUE7QUFDQUcsSUFBSSxDQUFDWCxVQUFVLENBQUMsSUFBSSxDQUFDOztBQUVyQjtBQUNBWSxPQUFPLENBQUNDLEVBQUUsQ0FBQyxvQkFBb0IsRUFBRSxDQUFDQyxNQUFNLEVBQUVDLE9BQU8sS0FBSztFQUNwREMsT0FBTyxDQUFDQyxLQUFLLENBQUMseUJBQXlCLEVBQUVGLE9BQU8sRUFBRSxTQUFTLEVBQUVELE1BQU0sQ0FBQztBQUN0RSxDQUFDLENBQUM7QUFFRkUsT0FBTyxDQUFDRSxHQUFHLENBQUMsaUJBQWlCLENBQUMiLCJpZ25vcmVMaXN0IjpbXX0=
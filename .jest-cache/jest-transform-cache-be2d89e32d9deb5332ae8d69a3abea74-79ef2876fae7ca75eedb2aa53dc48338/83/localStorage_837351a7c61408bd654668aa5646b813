090470efe70aa528981a5a00387b49a6
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.LocalStorageAdapter = void 0;
/**
 * LocalStorage 適配器
 * 提供標準化的 LocalStorage 介面
 * 
 * @author haotool
 * @version 7.2.3
 * @created 2025-08-18T02:39:58+08:00
 */

class LocalStorageAdapter {
  constructor(config = {}) {
    this.config = config;
    this.prefix = config.dbName ? `${config.dbName}:` : 'bunny-click:';
    this.isAvailable = this.checkAvailability();
  }

  /**
   * 檢查 LocalStorage 可用性
   */
  checkAvailability() {
    try {
      const testKey = '__storage_test__';
      localStorage.setItem(testKey, 'test');
      localStorage.removeItem(testKey);
      return true;
    } catch (e) {
      console.warn('⚠️ LocalStorage 不可用:', e);
      return false;
    }
  }

  /**
   * 初始化
   */
  async init() {
    if (!this.isAvailable) {
      throw new Error('LocalStorage 不可用');
    }

    // 清理過期資料
    await this.cleanupExpiredData();
    this.log('✅ LocalStorage 適配器初始化完成');
  }

  /**
   * 清理過期資料
   */
  async cleanupExpiredData() {
    try {
      const keys = Object.keys(localStorage);
      const prefixedKeys = keys.filter(key => key.startsWith(this.prefix));
      for (const key of prefixedKeys) {
        try {
          const data = JSON.parse(localStorage.getItem(key));

          // 檢查是否有過期時間且已過期
          if (data && data.__expires && Date.now() > data.__expires) {
            localStorage.removeItem(key);
            this.log(`🧹 清理過期資料: ${key}`);
          }
        } catch (parseError) {
          // 如果解析失敗，可能是舊格式資料，保留不動
          this.log(`⚠️ 跳過無法解析的資料: ${key}`);
        }
      }
    } catch (error) {
      this.log('⚠️ 清理過期資料時發生錯誤:', error);
    }
  }

  /**
   * 生成完整鍵名
   */
  getFullKey(key) {
    return `${this.prefix}${key}`;
  }

  /**
   * 儲存資料
   */
  async setItem(key, value, options = {}) {
    if (!this.isAvailable) {
      throw new Error('LocalStorage 不可用');
    }
    try {
      const fullKey = this.getFullKey(key);

      // 包裝資料，添加元資訊
      const wrappedData = {
        value,
        __timestamp: Date.now(),
        __version: this.config.version || 1
      };

      // 添加過期時間 (如果指定)
      if (options.ttl) {
        wrappedData.__expires = Date.now() + options.ttl;
      }
      const serializedData = JSON.stringify(wrappedData);

      // 檢查大小限制 (LocalStorage 通常限制為 5-10MB)
      if (serializedData.length > 5 * 1024 * 1024) {
        throw new Error('資料過大，超出 LocalStorage 限制');
      }
      localStorage.setItem(fullKey, serializedData);
      this.log(`💾 LocalStorage 儲存: ${key} (${this.formatBytes(serializedData.length)})`);
    } catch (error) {
      if (error.name === 'QuotaExceededError' || error.name === 'NS_ERROR_DOM_QUOTA_REACHED') {
        // 配額超出，嘗試清理舊資料
        await this.cleanupOldData();

        // 再次嘗試儲存
        try {
          const fullKey = this.getFullKey(key);
          const wrappedData = {
            value,
            __timestamp: Date.now()
          };
          localStorage.setItem(fullKey, JSON.stringify(wrappedData));
          this.log(`💾 LocalStorage 儲存 (清理後): ${key}`);
        } catch (retryError) {
          throw new Error(`LocalStorage 配額已滿且清理後仍無法儲存: ${retryError.message}`);
        }
      } else {
        throw error;
      }
    }
  }

  /**
   * 讀取資料
   */
  async getItem(key) {
    if (!this.isAvailable) {
      throw new Error('LocalStorage 不可用');
    }
    try {
      const fullKey = this.getFullKey(key);
      const serializedData = localStorage.getItem(fullKey);
      if (serializedData === null) {
        return null;
      }
      const wrappedData = JSON.parse(serializedData);

      // 檢查是否過期
      if (wrappedData.__expires && Date.now() > wrappedData.__expires) {
        localStorage.removeItem(fullKey);
        this.log(`⏰ 資料已過期並移除: ${key}`);
        return null;
      }

      // 相容性處理：如果沒有包裝結構，直接返回原始資料
      if (wrappedData.hasOwnProperty('value')) {
        this.log(`📖 LocalStorage 讀取: ${key}`);
        return wrappedData.value;
      } else {
        // 舊格式資料
        this.log(`📖 LocalStorage 讀取 (舊格式): ${key}`);
        return wrappedData;
      }
    } catch (error) {
      console.error(`❌ LocalStorage 讀取失敗 ${key}:`, error);
      return null;
    }
  }

  /**
   * 移除資料
   */
  async removeItem(key) {
    if (!this.isAvailable) {
      throw new Error('LocalStorage 不可用');
    }
    const fullKey = this.getFullKey(key);
    localStorage.removeItem(fullKey);
    this.log(`🗑️ LocalStorage 移除: ${key}`);
  }

  /**
   * 清空所有資料
   */
  async clear() {
    if (!this.isAvailable) {
      throw new Error('LocalStorage 不可用');
    }
    const keys = Object.keys(localStorage);
    const prefixedKeys = keys.filter(key => key.startsWith(this.prefix));
    for (const key of prefixedKeys) {
      localStorage.removeItem(key);
    }
    this.log(`🧹 LocalStorage 清空: ${prefixedKeys.length} 項目`);
  }

  /**
   * 獲取所有鍵名
   */
  async keys() {
    if (!this.isAvailable) {
      throw new Error('LocalStorage 不可用');
    }
    const keys = Object.keys(localStorage);
    return keys.filter(key => key.startsWith(this.prefix)).map(key => key.substring(this.prefix.length));
  }

  /**
   * 獲取儲存項目數量
   */
  async size() {
    const keys = await this.keys();
    return keys.length;
  }

  /**
   * 清理舊資料 (當配額不足時)
   */
  async cleanupOldData() {
    try {
      const keys = Object.keys(localStorage);
      const prefixedKeys = keys.filter(key => key.startsWith(this.prefix));

      // 獲取所有資料的時間戳記
      const dataWithTimestamp = [];
      for (const key of prefixedKeys) {
        try {
          const data = JSON.parse(localStorage.getItem(key));
          const timestamp = data.__timestamp || 0;
          dataWithTimestamp.push({
            key,
            timestamp
          });
        } catch (e) {
          // 無法解析的資料視為最舊
          dataWithTimestamp.push({
            key,
            timestamp: 0
          });
        }
      }

      // 按時間戳記排序，移除最舊的 25% 資料
      dataWithTimestamp.sort((a, b) => a.timestamp - b.timestamp);
      const itemsToRemove = Math.ceil(dataWithTimestamp.length * 0.25);
      for (let i = 0; i < itemsToRemove; i++) {
        localStorage.removeItem(dataWithTimestamp[i].key);
        this.log(`🧹 清理舊資料: ${dataWithTimestamp[i].key}`);
      }
      this.log(`🧹 清理完成，移除 ${itemsToRemove} 項舊資料`);
    } catch (error) {
      this.log('⚠️ 清理舊資料時發生錯誤:', error);
    }
  }

  /**
   * 格式化位元組大小
   */
  formatBytes(bytes) {
    if (bytes === 0) return '0 Bytes';
    const k = 1024;
    const sizes = ['Bytes', 'KB', 'MB'];
    const i = Math.floor(Math.log(bytes) / Math.log(k));
    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
  }

  /**
   * 調試日誌
   */
  log(...args) {
    if (this.config.debug) {
      console.log('📝 LocalStorageAdapter:', ...args);
    }
  }

  /**
   * 獲取使用統計
   */
  async getStats() {
    try {
      const keys = await this.keys();
      let totalSize = 0;
      for (const key of keys) {
        const fullKey = this.getFullKey(key);
        const data = localStorage.getItem(fullKey);
        if (data) {
          totalSize += data.length * 2; // UTF-16 字符佔 2 位元組
        }
      }
      return {
        itemCount: keys.length,
        totalSize,
        formattedSize: this.formatBytes(totalSize),
        maxSize: 5 * 1024 * 1024,
        // 5MB 估計值
        usagePercentage: totalSize / (5 * 1024 * 1024) * 100
      };
    } catch (error) {
      this.log('⚠️ 獲取統計資訊時發生錯誤:', error);
      return null;
    }
  }
}
exports.LocalStorageAdapter = LocalStorageAdapter;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJMb2NhbFN0b3JhZ2VBZGFwdGVyIiwiY29uc3RydWN0b3IiLCJjb25maWciLCJwcmVmaXgiLCJkYk5hbWUiLCJpc0F2YWlsYWJsZSIsImNoZWNrQXZhaWxhYmlsaXR5IiwidGVzdEtleSIsImxvY2FsU3RvcmFnZSIsInNldEl0ZW0iLCJyZW1vdmVJdGVtIiwiZSIsImNvbnNvbGUiLCJ3YXJuIiwiaW5pdCIsIkVycm9yIiwiY2xlYW51cEV4cGlyZWREYXRhIiwibG9nIiwia2V5cyIsIk9iamVjdCIsInByZWZpeGVkS2V5cyIsImZpbHRlciIsImtleSIsInN0YXJ0c1dpdGgiLCJkYXRhIiwiSlNPTiIsInBhcnNlIiwiZ2V0SXRlbSIsIl9fZXhwaXJlcyIsIkRhdGUiLCJub3ciLCJwYXJzZUVycm9yIiwiZXJyb3IiLCJnZXRGdWxsS2V5IiwidmFsdWUiLCJvcHRpb25zIiwiZnVsbEtleSIsIndyYXBwZWREYXRhIiwiX190aW1lc3RhbXAiLCJfX3ZlcnNpb24iLCJ2ZXJzaW9uIiwidHRsIiwic2VyaWFsaXplZERhdGEiLCJzdHJpbmdpZnkiLCJsZW5ndGgiLCJmb3JtYXRCeXRlcyIsIm5hbWUiLCJjbGVhbnVwT2xkRGF0YSIsInJldHJ5RXJyb3IiLCJtZXNzYWdlIiwiaGFzT3duUHJvcGVydHkiLCJjbGVhciIsIm1hcCIsInN1YnN0cmluZyIsInNpemUiLCJkYXRhV2l0aFRpbWVzdGFtcCIsInRpbWVzdGFtcCIsInB1c2giLCJzb3J0IiwiYSIsImIiLCJpdGVtc1RvUmVtb3ZlIiwiTWF0aCIsImNlaWwiLCJpIiwiYnl0ZXMiLCJrIiwic2l6ZXMiLCJmbG9vciIsInBhcnNlRmxvYXQiLCJwb3ciLCJ0b0ZpeGVkIiwiYXJncyIsImRlYnVnIiwiZ2V0U3RhdHMiLCJ0b3RhbFNpemUiLCJpdGVtQ291bnQiLCJmb3JtYXR0ZWRTaXplIiwibWF4U2l6ZSIsInVzYWdlUGVyY2VudGFnZSIsImV4cG9ydHMiXSwic291cmNlcyI6WyJsb2NhbFN0b3JhZ2UuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBMb2NhbFN0b3JhZ2Ug6YGp6YWN5ZmoXG4gKiDmj5DkvpvmqJnmupbljJbnmoQgTG9jYWxTdG9yYWdlIOS7i+mdolxuICogXG4gKiBAYXV0aG9yIGhhb3Rvb2xcbiAqIEB2ZXJzaW9uIDcuMi4zXG4gKiBAY3JlYXRlZCAyMDI1LTA4LTE4VDAyOjM5OjU4KzA4OjAwXG4gKi9cblxuZXhwb3J0IGNsYXNzIExvY2FsU3RvcmFnZUFkYXB0ZXIge1xuICBjb25zdHJ1Y3Rvcihjb25maWcgPSB7fSkge1xuICAgIHRoaXMuY29uZmlnID0gY29uZmlnO1xuICAgIHRoaXMucHJlZml4ID0gY29uZmlnLmRiTmFtZSA/IGAke2NvbmZpZy5kYk5hbWV9OmAgOiAnYnVubnktY2xpY2s6JztcbiAgICB0aGlzLmlzQXZhaWxhYmxlID0gdGhpcy5jaGVja0F2YWlsYWJpbGl0eSgpO1xuICB9XG5cbiAgLyoqXG4gICAqIOaqouafpSBMb2NhbFN0b3JhZ2Ug5Y+v55So5oCnXG4gICAqL1xuICBjaGVja0F2YWlsYWJpbGl0eSgpIHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgdGVzdEtleSA9ICdfX3N0b3JhZ2VfdGVzdF9fJztcbiAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKHRlc3RLZXksICd0ZXN0Jyk7XG4gICAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSh0ZXN0S2V5KTtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIGNvbnNvbGUud2Fybign4pqg77iPIExvY2FsU3RvcmFnZSDkuI3lj6/nlKg6JywgZSk7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIOWIneWni+WMllxuICAgKi9cbiAgYXN5bmMgaW5pdCgpIHtcbiAgICBpZiAoIXRoaXMuaXNBdmFpbGFibGUpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignTG9jYWxTdG9yYWdlIOS4jeWPr+eUqCcpO1xuICAgIH1cbiAgICBcbiAgICAvLyDmuIXnkIbpgY7mnJ/os4fmlplcbiAgICBhd2FpdCB0aGlzLmNsZWFudXBFeHBpcmVkRGF0YSgpO1xuICAgIFxuICAgIHRoaXMubG9nKCfinIUgTG9jYWxTdG9yYWdlIOmBqemFjeWZqOWIneWni+WMluWujOaIkCcpO1xuICB9XG5cbiAgLyoqXG4gICAqIOa4heeQhumBjuacn+izh+aWmVxuICAgKi9cbiAgYXN5bmMgY2xlYW51cEV4cGlyZWREYXRhKCkge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBrZXlzID0gT2JqZWN0LmtleXMobG9jYWxTdG9yYWdlKTtcbiAgICAgIGNvbnN0IHByZWZpeGVkS2V5cyA9IGtleXMuZmlsdGVyKGtleSA9PiBrZXkuc3RhcnRzV2l0aCh0aGlzLnByZWZpeCkpO1xuICAgICAgXG4gICAgICBmb3IgKGNvbnN0IGtleSBvZiBwcmVmaXhlZEtleXMpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBjb25zdCBkYXRhID0gSlNPTi5wYXJzZShsb2NhbFN0b3JhZ2UuZ2V0SXRlbShrZXkpKTtcbiAgICAgICAgICBcbiAgICAgICAgICAvLyDmqqLmn6XmmK/lkKbmnInpgY7mnJ/mmYLplpPkuJTlt7LpgY7mnJ9cbiAgICAgICAgICBpZiAoZGF0YSAmJiBkYXRhLl9fZXhwaXJlcyAmJiBEYXRlLm5vdygpID4gZGF0YS5fX2V4cGlyZXMpIHtcbiAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKGtleSk7XG4gICAgICAgICAgICB0aGlzLmxvZyhg8J+nuSDmuIXnkIbpgY7mnJ/os4fmlpk6ICR7a2V5fWApO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBjYXRjaCAocGFyc2VFcnJvcikge1xuICAgICAgICAgIC8vIOWmguaenOino+aekOWkseaVl++8jOWPr+iDveaYr+iIiuagvOW8j+izh+aWme+8jOS/neeVmeS4jeWLlVxuICAgICAgICAgIHRoaXMubG9nKGDimqDvuI8g6Lez6YGO54Sh5rOV6Kej5p6Q55qE6LOH5paZOiAke2tleX1gKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICB0aGlzLmxvZygn4pqg77iPIOa4heeQhumBjuacn+izh+aWmeaZgueZvOeUn+mMr+iqpDonLCBlcnJvcik7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIOeUn+aIkOWujOaVtOmNteWQjVxuICAgKi9cbiAgZ2V0RnVsbEtleShrZXkpIHtcbiAgICByZXR1cm4gYCR7dGhpcy5wcmVmaXh9JHtrZXl9YDtcbiAgfVxuXG4gIC8qKlxuICAgKiDlhLLlrZjos4fmlplcbiAgICovXG4gIGFzeW5jIHNldEl0ZW0oa2V5LCB2YWx1ZSwgb3B0aW9ucyA9IHt9KSB7XG4gICAgaWYgKCF0aGlzLmlzQXZhaWxhYmxlKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0xvY2FsU3RvcmFnZSDkuI3lj6/nlKgnKTtcbiAgICB9XG5cbiAgICB0cnkge1xuICAgICAgY29uc3QgZnVsbEtleSA9IHRoaXMuZ2V0RnVsbEtleShrZXkpO1xuICAgICAgXG4gICAgICAvLyDljIXoo53os4fmlpnvvIzmt7vliqDlhYPos4foqIpcbiAgICAgIGNvbnN0IHdyYXBwZWREYXRhID0ge1xuICAgICAgICB2YWx1ZSxcbiAgICAgICAgX190aW1lc3RhbXA6IERhdGUubm93KCksXG4gICAgICAgIF9fdmVyc2lvbjogdGhpcy5jb25maWcudmVyc2lvbiB8fCAxXG4gICAgICB9O1xuXG4gICAgICAvLyDmt7vliqDpgY7mnJ/mmYLplpMgKOWmguaenOaMh+WumilcbiAgICAgIGlmIChvcHRpb25zLnR0bCkge1xuICAgICAgICB3cmFwcGVkRGF0YS5fX2V4cGlyZXMgPSBEYXRlLm5vdygpICsgb3B0aW9ucy50dGw7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHNlcmlhbGl6ZWREYXRhID0gSlNPTi5zdHJpbmdpZnkod3JhcHBlZERhdGEpO1xuICAgICAgXG4gICAgICAvLyDmqqLmn6XlpKflsI/pmZDliLYgKExvY2FsU3RvcmFnZSDpgJrluLjpmZDliLbngrogNS0xME1CKVxuICAgICAgaWYgKHNlcmlhbGl6ZWREYXRhLmxlbmd0aCA+IDUgKiAxMDI0ICogMTAyNCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ+izh+aWmemBjuWkp++8jOi2heWHuiBMb2NhbFN0b3JhZ2Ug6ZmQ5Yi2Jyk7XG4gICAgICB9XG5cbiAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKGZ1bGxLZXksIHNlcmlhbGl6ZWREYXRhKTtcbiAgICAgIHRoaXMubG9nKGDwn5K+IExvY2FsU3RvcmFnZSDlhLLlrZg6ICR7a2V5fSAoJHt0aGlzLmZvcm1hdEJ5dGVzKHNlcmlhbGl6ZWREYXRhLmxlbmd0aCl9KWApO1xuICAgICAgXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGlmIChlcnJvci5uYW1lID09PSAnUXVvdGFFeGNlZWRlZEVycm9yJyB8fCBlcnJvci5uYW1lID09PSAnTlNfRVJST1JfRE9NX1FVT1RBX1JFQUNIRUQnKSB7XG4gICAgICAgIC8vIOmFjemhjei2heWHuu+8jOWYl+ippua4heeQhuiIiuizh+aWmVxuICAgICAgICBhd2FpdCB0aGlzLmNsZWFudXBPbGREYXRhKCk7XG4gICAgICAgIFxuICAgICAgICAvLyDlho3mrKHlmJfoqablhLLlrZhcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBjb25zdCBmdWxsS2V5ID0gdGhpcy5nZXRGdWxsS2V5KGtleSk7XG4gICAgICAgICAgY29uc3Qgd3JhcHBlZERhdGEgPSB7IHZhbHVlLCBfX3RpbWVzdGFtcDogRGF0ZS5ub3coKSB9O1xuICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKGZ1bGxLZXksIEpTT04uc3RyaW5naWZ5KHdyYXBwZWREYXRhKSk7XG4gICAgICAgICAgdGhpcy5sb2coYPCfkr4gTG9jYWxTdG9yYWdlIOWEsuWtmCAo5riF55CG5b6MKTogJHtrZXl9YCk7XG4gICAgICAgIH0gY2F0Y2ggKHJldHJ5RXJyb3IpIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYExvY2FsU3RvcmFnZSDphY3poY3lt7Lmu7/kuJTmuIXnkIblvozku43nhKHms5XlhLLlrZg6ICR7cmV0cnlFcnJvci5tZXNzYWdlfWApO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aHJvdyBlcnJvcjtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvKipcbiAgICog6K6A5Y+W6LOH5paZXG4gICAqL1xuICBhc3luYyBnZXRJdGVtKGtleSkge1xuICAgIGlmICghdGhpcy5pc0F2YWlsYWJsZSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdMb2NhbFN0b3JhZ2Ug5LiN5Y+v55SoJyk7XG4gICAgfVxuXG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGZ1bGxLZXkgPSB0aGlzLmdldEZ1bGxLZXkoa2V5KTtcbiAgICAgIGNvbnN0IHNlcmlhbGl6ZWREYXRhID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oZnVsbEtleSk7XG4gICAgICBcbiAgICAgIGlmIChzZXJpYWxpemVkRGF0YSA9PT0gbnVsbCkge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH1cblxuICAgICAgY29uc3Qgd3JhcHBlZERhdGEgPSBKU09OLnBhcnNlKHNlcmlhbGl6ZWREYXRhKTtcbiAgICAgIFxuICAgICAgLy8g5qqi5p+l5piv5ZCm6YGO5pyfXG4gICAgICBpZiAod3JhcHBlZERhdGEuX19leHBpcmVzICYmIERhdGUubm93KCkgPiB3cmFwcGVkRGF0YS5fX2V4cGlyZXMpIHtcbiAgICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oZnVsbEtleSk7XG4gICAgICAgIHRoaXMubG9nKGDij7Ag6LOH5paZ5bey6YGO5pyf5Lim56e76ZmkOiAke2tleX1gKTtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9XG5cbiAgICAgIC8vIOebuOWuueaAp+iZleeQhu+8muWmguaenOaykuacieWMheijnee1kOani++8jOebtOaOpei/lOWbnuWOn+Wni+izh+aWmVxuICAgICAgaWYgKHdyYXBwZWREYXRhLmhhc093blByb3BlcnR5KCd2YWx1ZScpKSB7XG4gICAgICAgIHRoaXMubG9nKGDwn5OWIExvY2FsU3RvcmFnZSDoroDlj5Y6ICR7a2V5fWApO1xuICAgICAgICByZXR1cm4gd3JhcHBlZERhdGEudmFsdWU7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyDoiIrmoLzlvI/os4fmlplcbiAgICAgICAgdGhpcy5sb2coYPCfk5YgTG9jYWxTdG9yYWdlIOiugOWPliAo6IiK5qC85byPKTogJHtrZXl9YCk7XG4gICAgICAgIHJldHVybiB3cmFwcGVkRGF0YTtcbiAgICAgIH1cbiAgICAgIFxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKGDinYwgTG9jYWxTdG9yYWdlIOiugOWPluWkseaVlyAke2tleX06YCwgZXJyb3IpO1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIOenu+mZpOizh+aWmVxuICAgKi9cbiAgYXN5bmMgcmVtb3ZlSXRlbShrZXkpIHtcbiAgICBpZiAoIXRoaXMuaXNBdmFpbGFibGUpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignTG9jYWxTdG9yYWdlIOS4jeWPr+eUqCcpO1xuICAgIH1cblxuICAgIGNvbnN0IGZ1bGxLZXkgPSB0aGlzLmdldEZ1bGxLZXkoa2V5KTtcbiAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbShmdWxsS2V5KTtcbiAgICB0aGlzLmxvZyhg8J+Xke+4jyBMb2NhbFN0b3JhZ2Ug56e76ZmkOiAke2tleX1gKTtcbiAgfVxuXG4gIC8qKlxuICAgKiDmuIXnqbrmiYDmnInos4fmlplcbiAgICovXG4gIGFzeW5jIGNsZWFyKCkge1xuICAgIGlmICghdGhpcy5pc0F2YWlsYWJsZSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdMb2NhbFN0b3JhZ2Ug5LiN5Y+v55SoJyk7XG4gICAgfVxuXG4gICAgY29uc3Qga2V5cyA9IE9iamVjdC5rZXlzKGxvY2FsU3RvcmFnZSk7XG4gICAgY29uc3QgcHJlZml4ZWRLZXlzID0ga2V5cy5maWx0ZXIoa2V5ID0+IGtleS5zdGFydHNXaXRoKHRoaXMucHJlZml4KSk7XG4gICAgXG4gICAgZm9yIChjb25zdCBrZXkgb2YgcHJlZml4ZWRLZXlzKSB7XG4gICAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbShrZXkpO1xuICAgIH1cbiAgICBcbiAgICB0aGlzLmxvZyhg8J+nuSBMb2NhbFN0b3JhZ2Ug5riF56m6OiAke3ByZWZpeGVkS2V5cy5sZW5ndGh9IOmgheebrmApO1xuICB9XG5cbiAgLyoqXG4gICAqIOeNsuWPluaJgOaciemNteWQjVxuICAgKi9cbiAgYXN5bmMga2V5cygpIHtcbiAgICBpZiAoIXRoaXMuaXNBdmFpbGFibGUpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignTG9jYWxTdG9yYWdlIOS4jeWPr+eUqCcpO1xuICAgIH1cblxuICAgIGNvbnN0IGtleXMgPSBPYmplY3Qua2V5cyhsb2NhbFN0b3JhZ2UpO1xuICAgIHJldHVybiBrZXlzXG4gICAgICAuZmlsdGVyKGtleSA9PiBrZXkuc3RhcnRzV2l0aCh0aGlzLnByZWZpeCkpXG4gICAgICAubWFwKGtleSA9PiBrZXkuc3Vic3RyaW5nKHRoaXMucHJlZml4Lmxlbmd0aCkpO1xuICB9XG5cbiAgLyoqXG4gICAqIOeNsuWPluWEsuWtmOmgheebruaVuOmHj1xuICAgKi9cbiAgYXN5bmMgc2l6ZSgpIHtcbiAgICBjb25zdCBrZXlzID0gYXdhaXQgdGhpcy5rZXlzKCk7XG4gICAgcmV0dXJuIGtleXMubGVuZ3RoO1xuICB9XG5cbiAgLyoqXG4gICAqIOa4heeQhuiIiuizh+aWmSAo55W26YWN6aGN5LiN6Laz5pmCKVxuICAgKi9cbiAgYXN5bmMgY2xlYW51cE9sZERhdGEoKSB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGtleXMgPSBPYmplY3Qua2V5cyhsb2NhbFN0b3JhZ2UpO1xuICAgICAgY29uc3QgcHJlZml4ZWRLZXlzID0ga2V5cy5maWx0ZXIoa2V5ID0+IGtleS5zdGFydHNXaXRoKHRoaXMucHJlZml4KSk7XG4gICAgICBcbiAgICAgIC8vIOeNsuWPluaJgOacieizh+aWmeeahOaZgumWk+aIs+iomFxuICAgICAgY29uc3QgZGF0YVdpdGhUaW1lc3RhbXAgPSBbXTtcbiAgICAgIFxuICAgICAgZm9yIChjb25zdCBrZXkgb2YgcHJlZml4ZWRLZXlzKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgY29uc3QgZGF0YSA9IEpTT04ucGFyc2UobG9jYWxTdG9yYWdlLmdldEl0ZW0oa2V5KSk7XG4gICAgICAgICAgY29uc3QgdGltZXN0YW1wID0gZGF0YS5fX3RpbWVzdGFtcCB8fCAwO1xuICAgICAgICAgIGRhdGFXaXRoVGltZXN0YW1wLnB1c2goeyBrZXksIHRpbWVzdGFtcCB9KTtcbiAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgIC8vIOeEoeazleino+aekOeahOizh+aWmeimlueCuuacgOiIilxuICAgICAgICAgIGRhdGFXaXRoVGltZXN0YW1wLnB1c2goeyBrZXksIHRpbWVzdGFtcDogMCB9KTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICAvLyDmjInmmYLplpPmiLPoqJjmjpLluo/vvIznp7vpmaTmnIDoiIrnmoQgMjUlIOizh+aWmVxuICAgICAgZGF0YVdpdGhUaW1lc3RhbXAuc29ydCgoYSwgYikgPT4gYS50aW1lc3RhbXAgLSBiLnRpbWVzdGFtcCk7XG4gICAgICBjb25zdCBpdGVtc1RvUmVtb3ZlID0gTWF0aC5jZWlsKGRhdGFXaXRoVGltZXN0YW1wLmxlbmd0aCAqIDAuMjUpO1xuICAgICAgXG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGl0ZW1zVG9SZW1vdmU7IGkrKykge1xuICAgICAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbShkYXRhV2l0aFRpbWVzdGFtcFtpXS5rZXkpO1xuICAgICAgICB0aGlzLmxvZyhg8J+nuSDmuIXnkIboiIros4fmlpk6ICR7ZGF0YVdpdGhUaW1lc3RhbXBbaV0ua2V5fWApO1xuICAgICAgfVxuICAgICAgXG4gICAgICB0aGlzLmxvZyhg8J+nuSDmuIXnkIblrozmiJDvvIznp7vpmaQgJHtpdGVtc1RvUmVtb3ZlfSDpoIXoiIros4fmlplgKTtcbiAgICAgIFxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICB0aGlzLmxvZygn4pqg77iPIOa4heeQhuiIiuizh+aWmeaZgueZvOeUn+mMr+iqpDonLCBlcnJvcik7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIOagvOW8j+WMluS9jeWFg+e1hOWkp+Wwj1xuICAgKi9cbiAgZm9ybWF0Qnl0ZXMoYnl0ZXMpIHtcbiAgICBpZiAoYnl0ZXMgPT09IDApIHJldHVybiAnMCBCeXRlcyc7XG4gICAgY29uc3QgayA9IDEwMjQ7XG4gICAgY29uc3Qgc2l6ZXMgPSBbJ0J5dGVzJywgJ0tCJywgJ01CJ107XG4gICAgY29uc3QgaSA9IE1hdGguZmxvb3IoTWF0aC5sb2coYnl0ZXMpIC8gTWF0aC5sb2coaykpO1xuICAgIHJldHVybiBwYXJzZUZsb2F0KChieXRlcyAvIE1hdGgucG93KGssIGkpKS50b0ZpeGVkKDIpKSArICcgJyArIHNpemVzW2ldO1xuICB9XG5cbiAgLyoqXG4gICAqIOiqv+ippuaXpeiqjFxuICAgKi9cbiAgbG9nKC4uLmFyZ3MpIHtcbiAgICBpZiAodGhpcy5jb25maWcuZGVidWcpIHtcbiAgICAgIGNvbnNvbGUubG9nKCfwn5OdIExvY2FsU3RvcmFnZUFkYXB0ZXI6JywgLi4uYXJncyk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIOeNsuWPluS9v+eUqOe1seioiFxuICAgKi9cbiAgYXN5bmMgZ2V0U3RhdHMoKSB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGtleXMgPSBhd2FpdCB0aGlzLmtleXMoKTtcbiAgICAgIGxldCB0b3RhbFNpemUgPSAwO1xuICAgICAgXG4gICAgICBmb3IgKGNvbnN0IGtleSBvZiBrZXlzKSB7XG4gICAgICAgIGNvbnN0IGZ1bGxLZXkgPSB0aGlzLmdldEZ1bGxLZXkoa2V5KTtcbiAgICAgICAgY29uc3QgZGF0YSA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKGZ1bGxLZXkpO1xuICAgICAgICBpZiAoZGF0YSkge1xuICAgICAgICAgIHRvdGFsU2l6ZSArPSBkYXRhLmxlbmd0aCAqIDI7IC8vIFVURi0xNiDlrZfnrKbkvZQgMiDkvY3lhYPntYRcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICByZXR1cm4ge1xuICAgICAgICBpdGVtQ291bnQ6IGtleXMubGVuZ3RoLFxuICAgICAgICB0b3RhbFNpemUsXG4gICAgICAgIGZvcm1hdHRlZFNpemU6IHRoaXMuZm9ybWF0Qnl0ZXModG90YWxTaXplKSxcbiAgICAgICAgbWF4U2l6ZTogNSAqIDEwMjQgKiAxMDI0LCAvLyA1TUIg5Lyw6KiI5YC8XG4gICAgICAgIHVzYWdlUGVyY2VudGFnZTogKHRvdGFsU2l6ZSAvICg1ICogMTAyNCAqIDEwMjQpKSAqIDEwMFxuICAgICAgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgdGhpcy5sb2coJ+KaoO+4jyDnjbLlj5bntbHoqIjos4foqIrmmYLnmbznlJ/pjK/oqqQ6JywgZXJyb3IpO1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICB9XG59XG4iXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRU8sTUFBTUEsbUJBQW1CLENBQUM7RUFDL0JDLFdBQVdBLENBQUNDLE1BQU0sR0FBRyxDQUFDLENBQUMsRUFBRTtJQUN2QixJQUFJLENBQUNBLE1BQU0sR0FBR0EsTUFBTTtJQUNwQixJQUFJLENBQUNDLE1BQU0sR0FBR0QsTUFBTSxDQUFDRSxNQUFNLEdBQUcsR0FBR0YsTUFBTSxDQUFDRSxNQUFNLEdBQUcsR0FBRyxjQUFjO0lBQ2xFLElBQUksQ0FBQ0MsV0FBVyxHQUFHLElBQUksQ0FBQ0MsaUJBQWlCLENBQUMsQ0FBQztFQUM3Qzs7RUFFQTtBQUNGO0FBQ0E7RUFDRUEsaUJBQWlCQSxDQUFBLEVBQUc7SUFDbEIsSUFBSTtNQUNGLE1BQU1DLE9BQU8sR0FBRyxrQkFBa0I7TUFDbENDLFlBQVksQ0FBQ0MsT0FBTyxDQUFD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
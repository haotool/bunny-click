3f736ea8e39bf5b83ac4f78df8304e8b
"use strict";

/**
 * 整合測試 - Bunny Click 專案
 * 測試主要功能模組的整合
 */

// Jest 全域對象由測試環境提供

// 模擬瀏覽器環境
global.window = {
  addEventListener: jest.fn(),
  removeEventListener: jest.fn(),
  location: {
    href: 'http://localhost:3000'
  },
  localStorage: {
    getItem: jest.fn(),
    setItem: jest.fn(),
    removeItem: jest.fn(),
    clear: jest.fn()
  },
  sessionStorage: {
    getItem: jest.fn(),
    setItem: jest.fn(),
    removeItem: jest.fn(),
    clear: jest.fn()
  }
};
global.document = {
  createElement: jest.fn(() => ({
    addEventListener: jest.fn(),
    removeEventListener: jest.fn(),
    setAttribute: jest.fn(),
    getAttribute: jest.fn(),
    appendChild: jest.fn(),
    removeChild: jest.fn(),
    innerHTML: '',
    textContent: '',
    style: {},
    classList: {
      add: jest.fn(),
      remove: jest.fn(),
      contains: jest.fn()
    }
  })),
  getElementById: jest.fn(),
  querySelector: jest.fn(),
  querySelectorAll: jest.fn(),
  addEventListener: jest.fn(),
  removeEventListener: jest.fn()
};
global.navigator = {
  serviceWorker: {
    register: jest.fn(),
    ready: Promise.resolve()
  },
  onLine: true
};

// 測試套件
describe('Bunny Click 整合測試', () => {
  beforeEach(() => {
    jest.clearAllMocks();
    jest.resetModules();
  });
  describe('PWA 功能整合', () => {
    test('Service Worker 註冊', async () => {
      // 模擬 Service Worker 註冊
      const mockRegister = jest.fn().mockResolvedValue({
        active: {
          state: 'activated'
        },
        installing: null,
        waiting: null
      });
      global.navigator.serviceWorker.register = mockRegister;

      // 這裡可以測試實際的 Service Worker 註冊邏輯
      expect(mockRegister).toBeDefined();
    });
    test('離線功能支援', () => {
      // 測試離線狀態檢測
      global.navigator.onLine = false;
      expect(global.navigator.onLine).toBe(false);
      global.navigator.onLine = true;
      expect(global.navigator.onLine).toBe(true);
    });
  });
  describe('本地儲存整合', () => {
    test('遊戲狀態儲存', () => {
      const mockSetItem = jest.fn();
      const mockGetItem = jest.fn();
      const mockLocalStorage = {
        setItem: mockSetItem,
        getItem: mockGetItem
      };
      global.window.localStorage = mockLocalStorage;
      const gameState = {
        score: 100,
        level: 5
      };

      // 測試儲存
      mockLocalStorage.setItem('gameState', JSON.stringify(gameState));
      expect(mockSetItem).toHaveBeenCalledWith('gameState', JSON.stringify(gameState));

      // 測試讀取
      mockGetItem.mockReturnValue(JSON.stringify(gameState));
      const retrieved = JSON.parse(mockLocalStorage.getItem('gameState'));
      expect(retrieved).toEqual(gameState);
    });
    test('快取清理', () => {
      const mockClear = jest.fn();
      const mockLocalStorage = {
        clear: mockClear
      };
      global.window.localStorage = mockLocalStorage;
      mockLocalStorage.clear();
      expect(mockClear).toHaveBeenCalled();
    });
  });
  describe('DOM 操作整合', () => {
    test('元素創建和操作', () => {
      const mockElement = global.document.createElement('div');
      expect(mockElement).toBeDefined();
      expect(mockElement.addEventListener).toBeDefined();
      expect(mockElement.setAttribute).toBeDefined();
    });
    test('事件監聽器管理', () => {
      const mockAddEventListener = jest.fn();
      const mockRemoveEventListener = jest.fn();
      const mockElement = {
        addEventListener: mockAddEventListener,
        removeEventListener: mockRemoveEventListener
      };
      const mockHandler = jest.fn();
      mockElement.addEventListener('click', mockHandler);
      expect(mockAddEventListener).toHaveBeenCalledWith('click', mockHandler);
      mockElement.removeEventListener('click', mockHandler);
      expect(mockRemoveEventListener).toHaveBeenCalledWith('click', mockHandler);
    });
  });
  describe('效能監控整合', () => {
    beforeEach(() => {
      // 確保每次測試前都有正確的 Performance API mock
      global.performance = {
        now: jest.fn(() => Date.now()),
        mark: jest.fn(),
        measure: jest.fn(),
        getEntriesByType: jest.fn(() => []),
        memory: {
          usedJSHeapSize: 10 * 1024 * 1024,
          totalJSHeapSize: 20 * 1024 * 1024,
          jsHeapSizeLimit: 100 * 1024 * 1024
        }
      };
    });
    test('效能指標收集', () => {
      // 確保 Performance API 完全可用（即時補強）
      if (!global.performance.mark) {
        global.performance.mark = jest.fn();
      }
      if (!global.performance.measure) {
        global.performance.measure = jest.fn();
      }

      // 驗證 Performance API 可用性
      expect(global.performance.now).toBeDefined();
      expect(global.performance.mark).toBeDefined();
      expect(global.performance.measure).toBeDefined();
    });
  });
  describe('錯誤處理整合', () => {
    test('全域錯誤處理', () => {
      const mockErrorHandler = jest.fn();
      const mockAddEventListener = jest.fn();
      global.window.addEventListener = mockAddEventListener;

      // 模擬錯誤事件監聽器
      global.window.addEventListener('error', mockErrorHandler);
      expect(mockAddEventListener).toHaveBeenCalledWith('error', mockErrorHandler);

      // 模擬未處理的 Promise 拒絕
      global.window.addEventListener('unhandledrejection', mockErrorHandler);
      expect(mockAddEventListener).toHaveBeenCalledWith('unhandledrejection', mockErrorHandler);
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJnbG9iYWwiLCJ3aW5kb3ciLCJhZGRFdmVudExpc3RlbmVyIiwiamVzdCIsImZuIiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsImxvY2F0aW9uIiwiaHJlZiIsImxvY2FsU3RvcmFnZSIsImdldEl0ZW0iLCJzZXRJdGVtIiwicmVtb3ZlSXRlbSIsImNsZWFyIiwic2Vzc2lvblN0b3JhZ2UiLCJkb2N1bWVudCIsImNyZWF0ZUVsZW1lbnQiLCJzZXRBdHRyaWJ1dGUiLCJnZXRBdHRyaWJ1dGUiLCJhcHBlbmRDaGlsZCIsInJlbW92ZUNoaWxkIiwiaW5uZXJIVE1MIiwidGV4dENvbnRlbnQiLCJzdHlsZSIsImNsYXNzTGlzdCIsImFkZCIsInJlbW92ZSIsImNvbnRhaW5zIiwiZ2V0RWxlbWVudEJ5SWQiLCJxdWVyeVNlbGVjdG9yIiwicXVlcnlTZWxlY3RvckFsbCIsIm5hdmlnYXRvciIsInNlcnZpY2VXb3JrZXIiLCJyZWdpc3RlciIsInJlYWR5IiwiUHJvbWlzZSIsInJlc29sdmUiLCJvbkxpbmUiLCJkZXNjcmliZSIsImJlZm9yZUVhY2giLCJjbGVhckFsbE1vY2tzIiwicmVzZXRNb2R1bGVzIiwidGVzdCIsIm1vY2tSZWdpc3RlciIsIm1vY2tSZXNvbHZlZFZhbHVlIiwiYWN0aXZlIiwic3RhdGUiLCJpbnN0YWxsaW5nIiwid2FpdGluZyIsImV4cGVjdCIsInRvQmVEZWZpbmVkIiwidG9CZSIsIm1vY2tTZXRJdGVtIiwibW9ja0dldEl0ZW0iLCJtb2NrTG9jYWxTdG9yYWdlIiwiZ2FtZVN0YXRlIiwic2NvcmUiLCJsZXZlbCIsIkpTT04iLCJzdHJpbmdpZnkiLCJ0b0hhdmVCZWVuQ2FsbGVkV2l0aCIsIm1vY2tSZXR1cm5WYWx1ZSIsInJldHJpZXZlZCIsInBhcnNlIiwidG9FcXVhbCIsIm1vY2tDbGVhciIsInRvSGF2ZUJlZW5DYWxsZWQiLCJtb2NrRWxlbWVudCIsIm1vY2tBZGRFdmVudExpc3RlbmVyIiwibW9ja1JlbW92ZUV2ZW50TGlzdGVuZXIiLCJtb2NrSGFuZGxlciIsInBlcmZvcm1hbmNlIiwibm93IiwiRGF0ZSIsIm1hcmsiLCJtZWFzdXJlIiwiZ2V0RW50cmllc0J5VHlwZSIsIm1lbW9yeSIsInVzZWRKU0hlYXBTaXplIiwidG90YWxKU0hlYXBTaXplIiwianNIZWFwU2l6ZUxpbWl0IiwibW9ja0Vycm9ySGFuZGxlciJdLCJzb3VyY2VzIjpbImludGVncmF0aW9uLnRlc3QuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiDmlbTlkIjmuKzoqaYgLSBCdW5ueSBDbGljayDlsIjmoYhcbiAqIOa4rOippuS4u+imgeWKn+iDveaooee1hOeahOaVtOWQiFxuICovXG5cbi8vIEplc3Qg5YWo5Z+f5bCN6LGh55Sx5ris6Kmm55Kw5aKD5o+Q5L6bXG5cbi8vIOaooeaTrOeAj+imveWZqOeSsOWig1xuZ2xvYmFsLndpbmRvdyA9IHtcbiAgYWRkRXZlbnRMaXN0ZW5lcjogamVzdC5mbigpLFxuICByZW1vdmVFdmVudExpc3RlbmVyOiBqZXN0LmZuKCksXG4gIGxvY2F0aW9uOiB7IGhyZWY6ICdodHRwOi8vbG9jYWxob3N0OjMwMDAnIH0sXG4gIGxvY2FsU3RvcmFnZToge1xuICAgIGdldEl0ZW06IGplc3QuZm4oKSxcbiAgICBzZXRJdGVtOiBqZXN0LmZuKCksXG4gICAgcmVtb3ZlSXRlbTogamVzdC5mbigpLFxuICAgIGNsZWFyOiBqZXN0LmZuKCksXG4gIH0sXG4gIHNlc3Npb25TdG9yYWdlOiB7XG4gICAgZ2V0SXRlbTogamVzdC5mbigpLFxuICAgIHNldEl0ZW06IGplc3QuZm4oKSxcbiAgICByZW1vdmVJdGVtOiBqZXN0LmZuKCksXG4gICAgY2xlYXI6IGplc3QuZm4oKSxcbiAgfSxcbn07XG5cbmdsb2JhbC5kb2N1bWVudCA9IHtcbiAgY3JlYXRlRWxlbWVudDogamVzdC5mbigoKSA9PiAoe1xuICAgIGFkZEV2ZW50TGlzdGVuZXI6IGplc3QuZm4oKSxcbiAgICByZW1vdmVFdmVudExpc3RlbmVyOiBqZXN0LmZuKCksXG4gICAgc2V0QXR0cmlidXRlOiBqZXN0LmZuKCksXG4gICAgZ2V0QXR0cmlidXRlOiBqZXN0LmZuKCksXG4gICAgYXBwZW5kQ2hpbGQ6IGplc3QuZm4oKSxcbiAgICByZW1vdmVDaGlsZDogamVzdC5mbigpLFxuICAgIGlubmVySFRNTDogJycsXG4gICAgdGV4dENvbnRlbnQ6ICcnLFxuICAgIHN0eWxlOiB7fSxcbiAgICBjbGFzc0xpc3Q6IHtcbiAgICAgIGFkZDogamVzdC5mbigpLFxuICAgICAgcmVtb3ZlOiBqZXN0LmZuKCksXG4gICAgICBjb250YWluczogamVzdC5mbigpLFxuICAgIH0sXG4gIH0pKSxcbiAgZ2V0RWxlbWVudEJ5SWQ6IGplc3QuZm4oKSxcbiAgcXVlcnlTZWxlY3RvcjogamVzdC5mbigpLFxuICBxdWVyeVNlbGVjdG9yQWxsOiBqZXN0LmZuKCksXG4gIGFkZEV2ZW50TGlzdGVuZXI6IGplc3QuZm4oKSxcbiAgcmVtb3ZlRXZlbnRMaXN0ZW5lcjogamVzdC5mbigpLFxufTtcblxuZ2xvYmFsLm5hdmlnYXRvciA9IHtcbiAgc2VydmljZVdvcmtlcjoge1xuICAgIHJlZ2lzdGVyOiBqZXN0LmZuKCksXG4gICAgcmVhZHk6IFByb21pc2UucmVzb2x2ZSgpLFxuICB9LFxuICBvbkxpbmU6IHRydWUsXG59O1xuXG4vLyDmuKzoqablpZfku7ZcbmRlc2NyaWJlKCdCdW5ueSBDbGljayDmlbTlkIjmuKzoqaYnLCAoKSA9PiB7XG4gIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgIGplc3QuY2xlYXJBbGxNb2NrcygpO1xuICAgIGplc3QucmVzZXRNb2R1bGVzKCk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdQV0Eg5Yqf6IO95pW05ZCIJywgKCkgPT4ge1xuICAgIHRlc3QoJ1NlcnZpY2UgV29ya2VyIOiou+WGiicsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIOaooeaTrCBTZXJ2aWNlIFdvcmtlciDoqLvlhopcbiAgICAgIGNvbnN0IG1vY2tSZWdpc3RlciA9IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICAgIGFjdGl2ZTogeyBzdGF0ZTogJ2FjdGl2YXRlZCcgfSxcbiAgICAgICAgaW5zdGFsbGluZzogbnVsbCxcbiAgICAgICAgd2FpdGluZzogbnVsbCxcbiAgICAgIH0pO1xuXG4gICAgICBnbG9iYWwubmF2aWdhdG9yLnNlcnZpY2VXb3JrZXIucmVnaXN0ZXIgPSBtb2NrUmVnaXN0ZXI7XG5cbiAgICAgIC8vIOmAmeijoeWPr+S7pea4rOippuWvpumam+eahCBTZXJ2aWNlIFdvcmtlciDoqLvlhorpgo/ovK9cbiAgICAgIGV4cGVjdChtb2NrUmVnaXN0ZXIpLnRvQmVEZWZpbmVkKCk7XG4gICAgfSk7XG5cbiAgICB0ZXN0KCfpm6Lnt5rlip/og73mlK/mj7QnLCAoKSA9PiB7XG4gICAgICAvLyDmuKzoqabpm6Lnt5rni4DmhYvmqqLmuKxcbiAgICAgIGdsb2JhbC5uYXZpZ2F0b3Iub25MaW5lID0gZmFsc2U7XG4gICAgICBleHBlY3QoZ2xvYmFsLm5hdmlnYXRvci5vbkxpbmUpLnRvQmUoZmFsc2UpO1xuXG4gICAgICBnbG9iYWwubmF2aWdhdG9yLm9uTGluZSA9IHRydWU7XG4gICAgICBleHBlY3QoZ2xvYmFsLm5hdmlnYXRvci5vbkxpbmUpLnRvQmUodHJ1ZSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCfmnKzlnLDlhLLlrZjmlbTlkIgnLCAoKSA9PiB7XG4gICAgdGVzdCgn6YGK5oiy54uA5oWL5YSy5a2YJywgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja1NldEl0ZW0gPSBqZXN0LmZuKCk7XG4gICAgICBjb25zdCBtb2NrR2V0SXRlbSA9IGplc3QuZm4oKTtcbiAgICAgIGNvbnN0IG1vY2tMb2NhbFN0b3JhZ2UgPSB7XG4gICAgICAgIHNldEl0ZW06IG1vY2tTZXRJdGVtLFxuICAgICAgICBnZXRJdGVtOiBtb2NrR2V0SXRlbSxcbiAgICAgIH07XG4gICAgICBnbG9iYWwud2luZG93LmxvY2FsU3RvcmFnZSA9IG1vY2tMb2NhbFN0b3JhZ2U7XG5cbiAgICAgIGNvbnN0IGdhbWVTdGF0ZSA9IHsgc2NvcmU6IDEwMCwgbGV2ZWw6IDUgfTtcblxuICAgICAgLy8g5ris6Kmm5YSy5a2YXG4gICAgICBtb2NrTG9jYWxTdG9yYWdlLnNldEl0ZW0oJ2dhbWVTdGF0ZScsIEpTT04uc3RyaW5naWZ5KGdhbWVTdGF0ZSkpO1xuICAgICAgZXhwZWN0KG1vY2tTZXRJdGVtKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnZ2FtZVN0YXRlJywgSlNPTi5zdHJpbmdpZnkoZ2FtZVN0YXRlKSk7XG5cbiAgICAgIC8vIOa4rOippuiugOWPllxuICAgICAgbW9ja0dldEl0ZW0ubW9ja1JldHVyblZhbHVlKEpTT04uc3RyaW5naWZ5KGdhbWVTdGF0ZSkpO1xuICAgICAgY29uc3QgcmV0cmlldmVkID0gSlNPTi5wYXJzZShtb2NrTG9jYWxTdG9yYWdlLmdldEl0ZW0oJ2dhbWVTdGF0ZScpKTtcbiAgICAgIGV4cGVjdChyZXRyaWV2ZWQpLnRvRXF1YWwoZ2FtZVN0YXRlKTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ+W/q+WPlua4heeQhicsICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tDbGVhciA9IGplc3QuZm4oKTtcbiAgICAgIGNvbnN0IG1vY2tMb2NhbFN0b3JhZ2UgPSB7XG4gICAgICAgIGNsZWFyOiBtb2NrQ2xlYXIsXG4gICAgICB9O1xuICAgICAgZ2xvYmFsLndpbmRvdy5sb2NhbFN0b3JhZ2UgPSBtb2NrTG9jYWxTdG9yYWdlO1xuXG4gICAgICBtb2NrTG9jYWxTdG9yYWdlLmNsZWFyKCk7XG4gICAgICBleHBlY3QobW9ja0NsZWFyKS50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdET00g5pON5L2c5pW05ZCIJywgKCkgPT4ge1xuICAgIHRlc3QoJ+WFg+e0oOWJteW7uuWSjOaTjeS9nCcsICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tFbGVtZW50ID0gZ2xvYmFsLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuXG4gICAgICBleHBlY3QobW9ja0VsZW1lbnQpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QobW9ja0VsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcikudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChtb2NrRWxlbWVudC5zZXRBdHRyaWJ1dGUpLnRvQmVEZWZpbmVkKCk7XG4gICAgfSk7XG5cbiAgICB0ZXN0KCfkuovku7bnm6Pogb3lmajnrqHnkIYnLCAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrQWRkRXZlbnRMaXN0ZW5lciA9IGplc3QuZm4oKTtcbiAgICAgIGNvbnN0IG1vY2tSZW1vdmVFdmVudExpc3RlbmVyID0gamVzdC5mbigpO1xuICAgICAgY29uc3QgbW9ja0VsZW1lbnQgPSB7XG4gICAgICAgIGFkZEV2ZW50TGlzdGVuZXI6IG1vY2tBZGRFdmVudExpc3RlbmVyLFxuICAgICAgICByZW1vdmVFdmVudExpc3RlbmVyOiBtb2NrUmVtb3ZlRXZlbnRMaXN0ZW5lcixcbiAgICAgIH07XG4gICAgICBjb25zdCBtb2NrSGFuZGxlciA9IGplc3QuZm4oKTtcblxuICAgICAgbW9ja0VsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBtb2NrSGFuZGxlcik7XG4gICAgICBleHBlY3QobW9ja0FkZEV2ZW50TGlzdGVuZXIpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdjbGljaycsIG1vY2tIYW5kbGVyKTtcblxuICAgICAgbW9ja0VsZW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcignY2xpY2snLCBtb2NrSGFuZGxlcik7XG4gICAgICBleHBlY3QobW9ja1JlbW92ZUV2ZW50TGlzdGVuZXIpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdjbGljaycsIG1vY2tIYW5kbGVyKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ+aViOiDveebo+aOp+aVtOWQiCcsICgpID0+IHtcbiAgICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICAgIC8vIOeiuuS/neavj+asoea4rOippuWJjemDveacieato+eiuueahCBQZXJmb3JtYW5jZSBBUEkgbW9ja1xuICAgICAgZ2xvYmFsLnBlcmZvcm1hbmNlID0ge1xuICAgICAgICBub3c6IGplc3QuZm4oKCkgPT4gRGF0ZS5ub3coKSksXG4gICAgICAgIG1hcms6IGplc3QuZm4oKSxcbiAgICAgICAgbWVhc3VyZTogamVzdC5mbigpLFxuICAgICAgICBnZXRFbnRyaWVzQnlUeXBlOiBqZXN0LmZuKCgpID0+IFtdKSxcbiAgICAgICAgbWVtb3J5OiB7XG4gICAgICAgICAgdXNlZEpTSGVhcFNpemU6IDEwICogMTAyNCAqIDEwMjQsXG4gICAgICAgICAgdG90YWxKU0hlYXBTaXplOiAyMCAqIDEwMjQgKiAxMDI0LFxuICAgICAgICAgIGpzSGVhcFNpemVMaW1pdDogMTAwICogMTAyNCAqIDEwMjQsXG4gICAgICAgIH0sXG4gICAgICB9O1xuICAgIH0pO1xuXG4gICAgdGVzdCgn5pWI6IO95oyH5qiZ5pS26ZuGJywgKCkgPT4ge1xuICAgICAgLy8g56K65L+dIFBlcmZvcm1hbmNlIEFQSSDlrozlhajlj6/nlKjvvIjljbPmmYLoo5zlvLfvvIlcbiAgICAgIGlmICghZ2xvYmFsLnBlcmZvcm1hbmNlLm1hcmspIHtcbiAgICAgICAgZ2xvYmFsLnBlcmZvcm1hbmNlLm1hcmsgPSBqZXN0LmZuKCk7XG4gICAgICB9XG4gICAgICBpZiAoIWdsb2JhbC5wZXJmb3JtYW5jZS5tZWFzdXJlKSB7XG4gICAgICAgIGdsb2JhbC5wZXJmb3JtYW5jZS5tZWFzdXJlID0gamVzdC5mbigpO1xuICAgICAgfVxuICAgICAgXG4gICAgICAvLyDpqZforYkgUGVyZm9ybWFuY2UgQVBJIOWPr+eUqOaAp1xuICAgICAgZXhwZWN0KGdsb2JhbC5wZXJmb3JtYW5jZS5ub3cpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QoZ2xvYmFsLnBlcmZvcm1hbmNlLm1hcmspLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QoZ2xvYmFsLnBlcmZvcm1hbmNlLm1lYXN1cmUpLnRvQmVEZWZpbmVkKCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCfpjK/oqqTomZXnkIbmlbTlkIgnLCAoKSA9PiB7XG4gICAgdGVzdCgn5YWo5Z+f6Yyv6Kqk6JmV55CGJywgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja0Vycm9ySGFuZGxlciA9IGplc3QuZm4oKTtcbiAgICAgIGNvbnN0IG1vY2tBZGRFdmVudExpc3RlbmVyID0gamVzdC5mbigpO1xuICAgICAgZ2xvYmFsLndpbmRvdy5hZGRFdmVudExpc3RlbmVyID0gbW9ja0FkZEV2ZW50TGlzdGVuZXI7XG5cbiAgICAgIC8vIOaooeaTrOmMr+iqpOS6i+S7tuebo+iBveWZqFxuICAgICAgZ2xvYmFsLndpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdlcnJvcicsIG1vY2tFcnJvckhhbmRsZXIpO1xuICAgICAgZXhwZWN0KG1vY2tBZGRFdmVudExpc3RlbmVyKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnZXJyb3InLCBtb2NrRXJyb3JIYW5kbGVyKTtcblxuICAgICAgLy8g5qih5pOs5pyq6JmV55CG55qEIFByb21pc2Ug5ouS57WVXG4gICAgICBnbG9iYWwud2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3VuaGFuZGxlZHJlamVjdGlvbicsIG1vY2tFcnJvckhhbmRsZXIpO1xuICAgICAgZXhwZWN0KG1vY2tBZGRFdmVudExpc3RlbmVyKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgJ3VuaGFuZGxlZHJlamVjdGlvbicsXG4gICAgICAgIG1vY2tFcnJvckhhbmRsZXIsXG4gICAgICApO1xuICAgIH0pO1xuICB9KTtcbn0pO1xuIl0sIm1hcHBpbmdzIjoiOztBQUFBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0FBLE1BQU0sQ0FBQ0MsTUFBTSxHQUFHO0VBQ2RDLGdCQUFnQixFQUFFQyxJQUFJLENBQUNDLEVBQUUsQ0FBQyxDQUFDO0VBQzNCQyxtQkFBbUIsRUFBRUYsSUFBSSxDQUFDQyxFQUFFLENBQUMsQ0FBQztFQUM5QkUsUUFBUSxFQUFFO0lBQUVDLElBQUks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
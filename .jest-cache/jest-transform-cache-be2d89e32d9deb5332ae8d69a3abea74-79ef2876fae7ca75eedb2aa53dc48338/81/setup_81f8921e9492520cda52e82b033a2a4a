892cc6b9df6b02bdd98aac998df4f7a8
"use strict";

/**
 * Jest 測試環境設置文件
 * 提供瀏覽器環境 polyfills 與模擬對象
 * [context7:/jestjs/jest:2025-08-20T01:33:46+08:00]
 */

// DOM polyfills for jsdom environment
global.requestAnimationFrame = callback => {
  return setTimeout(callback, 0);
};
global.cancelAnimationFrame = id => {
  clearTimeout(id);
};

// Performance API polyfill
if (!global.performance) {
  global.performance = {
    now: () => Date.now(),
    mark: () => {},
    measure: () => {},
    getEntriesByName: () => [],
    getEntriesByType: () => []
  };
}

// URL constructor polyfill for Web API tests
global.URL = global.URL || require('url').URL;

// Request/Response polyfills for PWA tests
global.Request = global.Request || class MockRequest {
  constructor(url, options = {}) {
    this.url = new URL(url, 'http://localhost').href;
    this.method = options.method || 'GET';
    this.headers = new Map(Object.entries(options.headers || {}));
  }
};
global.Response = global.Response || class MockResponse {
  constructor(body, options = {}) {
    this.body = body;
    this.status = options.status || 200;
    this.headers = new Map(Object.entries(options.headers || {}));
    this.ok = this.status >= 200 && this.status < 300;
  }
  async json() {
    return JSON.parse(this.body);
  }
  async text() {
    return this.body;
  }
};

// Navigator polyfill
Object.defineProperty(global, 'navigator', {
  value: {
    userAgent: 'Mozilla/5.0 (Test Environment)',
    serviceWorker: {
      register: jest.fn().mockResolvedValue({})
    }
  },
  writable: true
});

// Window event listener polyfill
global.addEventListener = global.addEventListener || jest.fn();
global.removeEventListener = global.removeEventListener || jest.fn();

// Console polyfill for cleaner test output
const originalError = console.error;
console.error = (...args) => {
  // Suppress expected errors in test environment
  if (args[0] && typeof args[0] === 'string' && (args[0].includes('Warning:') || args[0].includes('React'))) {
    return;
  }
  originalError.apply(console, args);
};

// Jest global setup for DOM mocks
global.beforeEach = global.beforeEach || (() => {});

// Service Worker 模擬（用於 PWA 測試）
global.ServiceWorkerRegistration = class MockServiceWorkerRegistration {
  constructor() {
    this.active = null;
    this.installing = null;
    this.waiting = null;
    this.scope = 'http://localhost/';
    this.updatefound = null;
  }
  addEventListener(event, listener) {
    if (event === 'updatefound') {
      this.updatefound = listener;
    }
  }
  removeEventListener() {}
  update() {
    return Promise.resolve();
  }
  unregister() {
    return Promise.resolve(true);
  }
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJnbG9iYWwiLCJyZXF1ZXN0QW5pbWF0aW9uRnJhbWUiLCJjYWxsYmFjayIsInNldFRpbWVvdXQiLCJjYW5jZWxBbmltYXRpb25GcmFtZSIsImlkIiwiY2xlYXJUaW1lb3V0IiwicGVyZm9ybWFuY2UiLCJub3ciLCJEYXRlIiwibWFyayIsIm1lYXN1cmUiLCJnZXRFbnRyaWVzQnlOYW1lIiwiZ2V0RW50cmllc0J5VHlwZSIsIlVSTCIsInJlcXVpcmUiLCJSZXF1ZXN0IiwiTW9ja1JlcXVlc3QiLCJjb25zdHJ1Y3RvciIsInVybCIsIm9wdGlvbnMiLCJocmVmIiwibWV0aG9kIiwiaGVhZGVycyIsIk1hcCIsIk9iamVjdCIsImVudHJpZXMiLCJSZXNwb25zZSIsIk1vY2tSZXNwb25zZSIsImJvZHkiLCJzdGF0dXMiLCJvayIsImpzb24iLCJKU09OIiwicGFyc2UiLCJ0ZXh0IiwiZGVmaW5lUHJvcGVydHkiLCJ2YWx1ZSIsInVzZXJBZ2VudCIsInNlcnZpY2VXb3JrZXIiLCJyZWdpc3RlciIsImplc3QiLCJmbiIsIm1vY2tSZXNvbHZlZFZhbHVlIiwid3JpdGFibGUiLCJhZGRFdmVudExpc3RlbmVyIiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsIm9yaWdpbmFsRXJyb3IiLCJjb25zb2xlIiwiZXJyb3IiLCJhcmdzIiwiaW5jbHVkZXMiLCJhcHBseSIsImJlZm9yZUVhY2giLCJTZXJ2aWNlV29ya2VyUmVnaXN0cmF0aW9uIiwiTW9ja1NlcnZpY2VXb3JrZXJSZWdpc3RyYXRpb24iLCJhY3RpdmUiLCJpbnN0YWxsaW5nIiwid2FpdGluZyIsInNjb3BlIiwidXBkYXRlZm91bmQiLCJldmVudCIsImxpc3RlbmVyIiwidXBkYXRlIiwiUHJvbWlzZSIsInJlc29sdmUiLCJ1bnJlZ2lzdGVyIl0sInNvdXJjZXMiOlsic2V0dXAuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBKZXN0IOa4rOippueSsOWig+ioree9ruaWh+S7tlxuICog5o+Q5L6b54CP6Ka95Zmo55Kw5aKDIHBvbHlmaWxscyDoiIfmqKHmk6zlsI3osaFcbiAqIFtjb250ZXh0NzovamVzdGpzL2plc3Q6MjAyNS0wOC0yMFQwMTozMzo0NiswODowMF1cbiAqL1xuXG4vLyBET00gcG9seWZpbGxzIGZvciBqc2RvbSBlbnZpcm9ubWVudFxuZ2xvYmFsLnJlcXVlc3RBbmltYXRpb25GcmFtZSA9IChjYWxsYmFjaykgPT4ge1xuICByZXR1cm4gc2V0VGltZW91dChjYWxsYmFjaywgMCk7XG59O1xuXG5nbG9iYWwuY2FuY2VsQW5pbWF0aW9uRnJhbWUgPSAoaWQpID0+IHtcbiAgY2xlYXJUaW1lb3V0KGlkKTtcbn07XG5cbi8vIFBlcmZvcm1hbmNlIEFQSSBwb2x5ZmlsbFxuaWYgKCFnbG9iYWwucGVyZm9ybWFuY2UpIHtcbiAgZ2xvYmFsLnBlcmZvcm1hbmNlID0ge1xuICAgIG5vdzogKCkgPT4gRGF0ZS5ub3coKSxcbiAgICBtYXJrOiAoKSA9PiB7fSxcbiAgICBtZWFzdXJlOiAoKSA9PiB7fSxcbiAgICBnZXRFbnRyaWVzQnlOYW1lOiAoKSA9PiBbXSxcbiAgICBnZXRFbnRyaWVzQnlUeXBlOiAoKSA9PiBbXSxcbiAgfTtcbn1cblxuLy8gVVJMIGNvbnN0cnVjdG9yIHBvbHlmaWxsIGZvciBXZWIgQVBJIHRlc3RzXG5nbG9iYWwuVVJMID0gZ2xvYmFsLlVSTCB8fCByZXF1aXJlKCd1cmwnKS5VUkw7XG5cbi8vIFJlcXVlc3QvUmVzcG9uc2UgcG9seWZpbGxzIGZvciBQV0EgdGVzdHNcbmdsb2JhbC5SZXF1ZXN0ID0gZ2xvYmFsLlJlcXVlc3QgfHwgY2xhc3MgTW9ja1JlcXVlc3Qge1xuICBjb25zdHJ1Y3Rvcih1cmwsIG9wdGlvbnMgPSB7fSkge1xuICAgIHRoaXMudXJsID0gbmV3IFVSTCh1cmwsICdodHRwOi8vbG9jYWxob3N0JykuaHJlZjtcbiAgICB0aGlzLm1ldGhvZCA9IG9wdGlvbnMubWV0aG9kIHx8ICdHRVQnO1xuICAgIHRoaXMuaGVhZGVycyA9IG5ldyBNYXAoT2JqZWN0LmVudHJpZXMob3B0aW9ucy5oZWFkZXJzIHx8IHt9KSk7XG4gIH1cbn07XG5cbmdsb2JhbC5SZXNwb25zZSA9IGdsb2JhbC5SZXNwb25zZSB8fCBjbGFzcyBNb2NrUmVzcG9uc2Uge1xuICBjb25zdHJ1Y3Rvcihib2R5LCBvcHRpb25zID0ge30pIHtcbiAgICB0aGlzLmJvZHkgPSBib2R5O1xuICAgIHRoaXMuc3RhdHVzID0gb3B0aW9ucy5zdGF0dXMgfHwgMjAwO1xuICAgIHRoaXMuaGVhZGVycyA9IG5ldyBNYXAoT2JqZWN0LmVudHJpZXMob3B0aW9ucy5oZWFkZXJzIHx8IHt9KSk7XG4gICAgdGhpcy5vayA9IHRoaXMuc3RhdHVzID49IDIwMCAmJiB0aGlzLnN0YXR1cyA8IDMwMDtcbiAgfVxuICBcbiAgYXN5bmMganNvbigpIHtcbiAgICByZXR1cm4gSlNPTi5wYXJzZSh0aGlzLmJvZHkpO1xuICB9XG4gIFxuICBhc3luYyB0ZXh0KCkge1xuICAgIHJldHVybiB0aGlzLmJvZHk7XG4gIH1cbn07XG5cbi8vIE5hdmlnYXRvciBwb2x5ZmlsbFxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGdsb2JhbCwgJ25hdmlnYXRvcicsIHtcbiAgdmFsdWU6IHtcbiAgICB1c2VyQWdlbnQ6ICdNb3ppbGxhLzUuMCAoVGVzdCBFbnZpcm9ubWVudCknLFxuICAgIHNlcnZpY2VXb3JrZXI6IHtcbiAgICAgIHJlZ2lzdGVyOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoe30pLFxuICAgIH0sXG4gIH0sXG4gIHdyaXRhYmxlOiB0cnVlLFxufSk7XG5cbi8vIFdpbmRvdyBldmVudCBsaXN0ZW5lciBwb2x5ZmlsbFxuZ2xvYmFsLmFkZEV2ZW50TGlzdGVuZXIgPSBnbG9iYWwuYWRkRXZlbnRMaXN0ZW5lciB8fCBqZXN0LmZuKCk7XG5nbG9iYWwucmVtb3ZlRXZlbnRMaXN0ZW5lciA9IGdsb2JhbC5yZW1vdmVFdmVudExpc3RlbmVyIHx8IGplc3QuZm4oKTtcblxuLy8gQ29uc29sZSBwb2x5ZmlsbCBmb3IgY2xlYW5lciB0ZXN0IG91dHB1dFxuY29uc3Qgb3JpZ2luYWxFcnJvciA9IGNvbnNvbGUuZXJyb3I7XG5jb25zb2xlLmVycm9yID0gKC4uLmFyZ3MpID0+IHtcbiAgLy8gU3VwcHJlc3MgZXhwZWN0ZWQgZXJyb3JzIGluIHRlc3QgZW52aXJvbm1lbnRcbiAgaWYgKGFyZ3NbMF0gJiYgdHlwZW9mIGFyZ3NbMF0gPT09ICdzdHJpbmcnICYmIFxuICAgICAgKGFyZ3NbMF0uaW5jbHVkZXMoJ1dhcm5pbmc6JykgfHwgYXJnc1swXS5pbmNsdWRlcygnUmVhY3QnKSkpIHtcbiAgICByZXR1cm47XG4gIH1cbiAgb3JpZ2luYWxFcnJvci5hcHBseShjb25zb2xlLCBhcmdzKTtcbn07XG5cbi8vIEplc3QgZ2xvYmFsIHNldHVwIGZvciBET00gbW9ja3Ncbmdsb2JhbC5iZWZvcmVFYWNoID0gZ2xvYmFsLmJlZm9yZUVhY2ggfHwgKCgpID0+IHt9KTtcblxuLy8gU2VydmljZSBXb3JrZXIg5qih5pOs77yI55So5pa8IFBXQSDmuKzoqabvvIlcbmdsb2JhbC5TZXJ2aWNlV29ya2VyUmVnaXN0cmF0aW9uID0gY2xhc3MgTW9ja1NlcnZpY2VXb3JrZXJSZWdpc3RyYXRpb24ge1xuICBjb25zdHJ1Y3RvcigpIHtcbiAgICB0aGlzLmFjdGl2ZSA9IG51bGw7XG4gICAgdGhpcy5pbnN0YWxsaW5nID0gbnVsbDtcbiAgICB0aGlzLndhaXRpbmcgPSBudWxsO1xuICAgIHRoaXMuc2NvcGUgPSAnaHR0cDovL2xvY2FsaG9zdC8nO1xuICAgIHRoaXMudXBkYXRlZm91bmQgPSBudWxsO1xuICB9XG5cbiAgYWRkRXZlbnRMaXN0ZW5lcihldmVudCwgbGlzdGVuZXIpIHtcbiAgICBpZiAoZXZlbnQgPT09ICd1cGRhdGVmb3VuZCcpIHtcbiAgICAgIHRoaXMudXBkYXRlZm91bmQgPSBsaXN0ZW5lcjtcbiAgICB9XG4gIH1cblxuICByZW1vdmVFdmVudExpc3RlbmVyKCkge31cblxuICB1cGRhdGUoKSB7XG4gICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgpO1xuICB9XG5cbiAgdW5yZWdpc3RlcigpIHtcbiAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHRydWUpO1xuICB9XG59OyJdLCJtYXBwaW5ncyI6Ijs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0FBLE1BQU0sQ0FBQ0MscUJBQXFCLEdBQUlDLFFBQVEsSUFBSztFQUMzQyxPQUFPQyxVQUFVLENBQUNELFFBQVEsRUFBRSxDQUFDLENBQUM7QUFDaEMsQ0FBQztBQUVERixNQUFNLENBQUNJLG9CQUFvQixHQUFJQyxFQUFFLElBQUs7RUFDcENDLFlBQVksQ0FBQ0QsRUFBRSxDQUFDO0FBQ2xCLENBQUM7O0FBRUQ7QUFDQSxJQUFJLENBQUNMLE1BQU0sQ0FBQ08sV0FBVyxFQUFFO0VBQ3ZCUCxNQUFNLENBQUNPLFdBQVcsR0FBRztJQUNuQkMsR0FBRyxFQUFFQSxDQUFBLEtBQU1DLElBQUksQ0FBQ0QsR0FBRyxDQUFDLENBQUM7SUFDckJFLElBQUksRUFBRUEsQ0FBQSxLQUFNLENBQUMsQ0FBQztJQUNkQyxPQUFPLEVBQUVBLENBQUEsS0FBTSxDQUFDLENBQUM7SUFDakJDLGdCQUFnQixFQUFFQSxDQUFBLEtBQU0sRUFBRTtJQUMxQkMsZ0JBQWdCLEVBQUVBLENBQUEsS0FBTTtFQUMxQixDQUFDO0FBQ0g7O0FBRUE7QUFDQWIsTUFBTSxDQUFDYyxHQUFHLEdBQUdkLE1BQU0sQ0FBQ2MsR0FBRyxJQUFJQyxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUNELEdBQUc7O0FBRTdDO0FBQ0FkLE1BQU0sQ0FBQ2dCLE9BQU8sR0FBR2hCLE1BQU0sQ0FBQ2dCLE9BQU8sSUFBSSxNQUFNQyxXQUFXLENBQUM7RUFDbkRDLFdBQVdBLENBQUNDLEdBQUcsRUFBRUMsT0FBTyxHQUFHLENBQUMsQ0FBQyxFQUFFO0lBQzdCLElBQUksQ0FBQ0QsR0FBRyxHQUFHLElBQUlMLEdBQUcsQ0FBQ0ssR0FBRyxFQUFFLGtCQUFrQixDQUFDLENBQUNFLElBQUk7SUFDaEQsSUFBSSxDQUFDQyxNQUFNLEdBQUdGLE9BQU8sQ0FBQ0Us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